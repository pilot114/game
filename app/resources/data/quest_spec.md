Здесь представлена основная техническая информация по The Long Story - текстовой RPG игре
с упором на квестовую составляющую. The Long Story в некотором смысле представляет собой движок
для RPG игр, весь контент игры описывается в простых игровых ресурсах
(конфиг в yaml, аудиофайлы и картинки), что позволяет игрокам самим добавлять в игру
новые локации, квесты и персонажей.

Далее даны определения основных терминов и спецификация конфига.

# Локации, типы локаций, миры

Локация это некоторая область, в которой может находиться игрок. 
В каждой локации есть набор объектов, с которыми игрок может взаимодействовать.
Локации могут быть вложенными, например:

    город > таверна > подвал таверны

Ограничения:
1. Обычные локации ограничены максимальным размером координатной сетки (255x255), но могут быть
и совсем маленькими, например 2x4. Условно можно считать, что 1 клетка локации = 1 квадратному метру.
2. В одной локации не должно быть более 255 объектов.

> **Технический момент**  
> Таким образом, данные о локации эффективно хранятся в памяти (3 байта на каждый объект = id + координаты).

Также есть безразмерные локации - они предназначены для перемещения между обычными
локациями (путешествие). В них нет постоянных объектов, но могут быть "случайные события".

Есть несколько способов перемещения между локациями:
- путешествие
- дверь (условно, это может быть лестница, ворота и т.д.)
- портал (односторонний или двухсторонний)

Мир (сеттинг) - это безразмерная локация, в которой находятся все другие локации.
В одном мире существует один общий лор (история, легенды, языки и т.д.), физические правила, 
и, возможно, даже ролевая система (в данный момент есть одна ролевая система по умолчанию).

Теоретически, миров может быть любое количество. Перемещение между мирами допускается
только через порталы. При перемещении персонажа между мирами, к нему должна применяться особая
процедура конвертации (изменение характеристик, предметов и пр.).

> **Технический момент**  
> Описание сеттинга представлено в виде отдельного документа, для того чтобы его было
> удобно использовать для генерации контента с помощью LLM (см. далее)

# Объекты, виды объектов, действия

Объект - это всё, с чем может взаимодействовать игрок. У каждого объекта есть собственное и игровое описание,
а также список возможных действий.

Виды объектов (не взаимоисключают друг друга):
- Персонаж - это любой объект, с которым возможен диалог (не обязательно осмысленный)
- Предмет - объект, который можно взять
- Общий объект - доступен в любом месте локации (нет конкретного размещения)
- Контейнер - объект, в котором могут быть предметы
- ...

Есть список стандартных действий:

| Действие   | Объект       |
|------------|--------------|
| Осмотреть  | Любой объект |
| Атаковать  | Любой объект |
| Поговорить | Персонаж     |
| Взять      | Предмет      |

Также у большинства предметов есть действие "Использовать".  
Оно может быть уточнено в зависимости от предмета и контекста
(съесть, прочитать, соединить, открыть и т.д.). Результаты использования
могут быть совершенно разные и должны быть прописаны в самом предмете.

Также есть действия, не применяемые к объектам напрямую:
- Отдохнуть - восстановление сил. Также можно использовать, чтобы подождать чего-либо
- Осмотреться - позволяет находить скрытые объекты (при соответствующих навыках)

# Квесты, диалоги, проверки

Квесты позволяют продвигать вперёд сюжет и служат основным способом получения опыта.  
Каждый квест состоит из набора задач (= этапы квеста). Квесты могут иметь развилки.
Квест может обращаться к объектам в локациях, а также добавлять / удалять свои объекты.

Диалог может быть как частью квеста, так у сущестововать отдельно. Каждый персонаж  
так или иначе имеет свой основной диалог. Диалоги могут иметь развилки и циклы.

В квестах и диалогах в любом месте могут быть сделаны проверки данных персонажа
(характеристики, навыка, наличия предмета), а также временных переменных, создаваемых самим квестом / персонажем.

Примеры проверок:
- Персонаж скажет фразу, только если сила игрока > 15
- Игрок может сказать фразу, только если его мудрость >= 12
- Этап квеста будет начат, если у игрока есть предмет 123
- 3 этап квеста будет начат, если выполнены флаги, выставленные на этапах 1 и 2

Вся основная информация по прогрессу квестов сохраняется в журнале квестов.

# Случайные события

Для каждой локации возможно прописать случайные события (по сути мини-квесты).  
Они позволяют сделать мир более случайным и наполненным событиями.  
Помимо обычных условий для старта, такие события также используют некоторое
значение вероятности, при которой они произойдут.

# Ролевая система

Ролевая система (РС) определяет набор характеристик игрока (и прочих персонажей), а также их влияние
на игровые механики. Также РС определяет то, как персонаж "прокачивается" с ростом уровня.

> **В разработке!**  
D&D (5 редакция) взята как основа, но РС из серий Fallout и The Elder Scrolls также 
стоит рассматривать как референс, они более адаптированы к использованию в компьютерной игре.
Вероятно, в итоге будет своя система? (что там с лицензированием?)

Персонаж игрока обладает следующими аттрибутами:

- физические характеристики: сила, телосложение, ловкость
- ментальные характеристики: интеллект, мудрость, харизма
- раса
- класс (специализация)
- восполняющиеся: здоровье, мана, энергия
- развитие: опыт, уровень
- врожденный талант (позитивный + негативный эффект)

# Использование LLM (больших языковых моделей)

Описание локаций и объектов разработано таким образом, чтобы LLM могли как можно более
эффективно использовать его для создания диалогов и квестов.

Весь процесс создания контента может быть автоматизирован (требуется только корректировка
на каждом из этапов) и разбит на следующие подзадачи:
- Дать описание формата (из этого документа)
- Дать описание сеттинга (второй документ)
- Сформировать список локаций
- Сформировать список объектов для каждой локации
- Сформировать основные диалоги персонажей
- Сформировать квесты и квестовые диалоги
- Сформировать случайные встречи

# Формальное описание локации

Объект `Location`:

    name (string)                   - имя локации в игре (в строке контекста)
    info (string)                   - описание локации для LLM
    description (string)            - внутриигровое описание локации
    grid (string<Grid>)             - перечисление местоположений объектов
    objects (array<string, Object>) - все объекты в локации
    npc (array<string, Person>)     - дял удобства, объекты NPC описываются отдельно
    quests (array<string, Quest>)   - квесты

Пример строки Grid: `well:20:10 scarecrow:27:22 bench:22:14 `  
Ключи в `entities` и `quests` являются уникальными идентификаторами на английском языке.

Объект `Entity`:

    name (string)             - имя объекта в игре (в списке доступных объектов локации)
    info (string)             - описание объекта для LLM
    description (string)      - внутриигровое описание объекта
    types (string<ObjectType>) - типы объекта

Пример строки ObjectType: `item container`

Объект `Quest`:

    name (string)            - имя квеста в игре (в журнале квестов)
    info (string)            - описание квеста для LLM
    description (string)     - внутриигровое описание квеста
    tasks (array<int, Task>) - список этапов квеста

Объект `Task`:  

    trigger (string)    - логическое выражение, определяющее начало задания
    journal (string)    - запись в журнале
    message (string)    - сообщение в лог действий
    set (string<ToSet>) - установка переменных квеста
    commands (array<string<Command>>) - для изменения объектов / диалогов

Пример строки Command: `add tawerna.levy, delete tawerna.konny`  
Пример строки ToSet: `timer = 1d, checkpoint1 = hero.position in village`

Объект `Dialog` представляет собой набор вложенных объектов, все ключи которых
являются фразами диалога. Все значения в этих объектах являются или также объектами,
или строковыми идентификаторами диалоговых действий:
- up: вернуться на уровень выше
- start: вернуться в начало (корень) диалога
- end: конец диалога
- trade: начать торговлю
- battle: начать бой
- drop+(up/start/end): убрать текущий вариант диалога

# Интерфейс игры

> **В разработке!**  
В данный момент постоянно меняется. Потом сюда нужно будет добавить скрины

Интерфейс состоит из нескольких блоков:
- блок описаний. В нём находится текстовое описание окружения
- блок состояния. основные показатели игрока, эффекты
- строка контекста. Имя текущей локации, игровые время и дата, погодные условия и пр.
- список объектов. Перечислены объекты, с которыми сейчас возможно взаимодействие
- блок лога. В нём представлены игровые события и прочая дополнительная информация (например, всё что слышит игрок)

Также есть интерфейсы, которые можно открывать горячими клавишами:
- (I) Инвентарь
- (J) Журнал заданий
- (Esc) Главное меню

Дополнительные интерфейсы, вызываемые событиями в игрe:
- интерфейс диалога
- интерфейс боя
- интерфейс обмена (торговли)
- интерфейс контейнера
